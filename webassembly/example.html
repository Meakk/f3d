<!DOCTYPE html>
<html data-theme="dark">

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
  <style>
    #main {
      min-height: 70vh;
      border: 1px solid hsl(348, 86%, 43%);
      border-radius: 0.5rem;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <section class="section">
    <div class="container">
      <h1 class="title">F3D Web</h1>
      <p class="subtitle">
        A webassembly build demo
      </p>
    </div>
  </section>
  <section class="section">
    <div class="container" id="main">
      <canvas id="canvas"></canvas>
    </div>
  </section>
  <script type="text/javascript" src="f3d.js"></script>
  <script type="text/javascript">
    let Module = {
      canvas: (() => {
        return document.getElementById("canvas");
      })(),
      onRuntimeInitialized: () => { },
    };

    f3d(Module).then((runtime) => {
      // automatically load all supported file format readers
      Module.Engine.autoloadPlugins();

      Module.engineInstance = new Module.Engine();

      // setup coloring
      Module.engineInstance.getOptions().set_string('model.scivis.array-name', 'Colors');
      Module.engineInstance.getOptions().set_integer('model.scivis.component', -2);
      Module.engineInstance.getOptions().toggle('model.scivis.cells');

      // make it look nice
      Module.engineInstance.getOptions().toggle('render.effect.anti-aliasing');
      Module.engineInstance.getOptions().toggle('render.effect.tone-mapping');
      Module.engineInstance.getOptions().toggle('interactor.axis');

      // up is +Z on this file
      Module.engineInstance.getOptions().set_string('scene.up-direction', '+Z')

      // load the file located in the virtual filesystem
      Module.engineInstance.getLoader().loadGeometry('/f3d.vtp');

      // setup the window size based on the canvas size
      const main = document.getElementById('main');
      const scale = window.devicePixelRatio;
      Module.engineInstance.getWindow().setSize(scale * main.clientWidth, scale * main.clientHeight);

      // do a first render and start the interactor
      Module.engineInstance.getWindow().render();
      Module.engineInstance.getInteractor().start();
    }).catch(error => console.error("Internal exception: " + error));
  </script>
</body>

</html>
